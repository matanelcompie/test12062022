
<html>
  <head>
    <title>Demo</title>
	
<script src="/js/sip-0.12.0.test.js"></script>



  </head>

  <body>
<video id="remote_video"></video>
<video id="local_video" muted="muted"></video>
<button id="hold">hold</button>
<button id="unhold">unhold</button>


<script>

let config = {
    userAgentString: 'SIP.js/0.12.0 BB',
    uri: "1000@dialer1.shass.co.il",
    transportOptions: {
    	wsServers: ["wss://dialer1.shass.co.il:7443/ws"]
    },
    authorizationUser: 1000,
    password: "LCSfiS97LgqyIt6Wsg2y",
    traceSip: true
};

var currentSession = null;
var ua = new SIP.UA(config);
ua.register();
var options = {
    	sessionDescriptionHandlerOptions: {
			constraints: {
			  audio: true,
			  video: false
			}
		}
};

    var optionsa = {
        media: {
            constraints: {
                audio: true,
                video: false
            },
            render: {
                remote: document.getElementById('remote_video'),
                local: document.getElementById('local_video')
            }
        }
    };

ua.on('registered', function () {
    console.log("registered");
    currentSession = ua.invite("2222@dialer1.shass.co.il", options);
	
	currentSession.on('trackAdded', function() {
		console.log("track added");
		
		var remoteVideo = document.getElementById('remote_video');
		var localVideo = document.getElementById('local_video');
		  // We need to check the peer connection to determine which track was added

		  var pc = currentSession.sessionDescriptionHandler.peerConnection;

		  // Gets remote tracks
		  var remoteStream = new MediaStream();
		  console.log(pc.getReceivers());
		  pc.getReceivers().forEach(function(receiver) {
			remoteStream.addTrack(receiver.track);
		  });
		  remoteVideo.srcObject = remoteStream;
		  remoteVideo.play();

		  // Gets local tracks
		  var localStream = new MediaStream();
		  pc.getSenders().forEach(function(sender) {
			localStream.addTrack(sender.track);
		  });
		  localVideo.srcObject = localStream;
		  localVideo.play();
		});
	});

ua.on('invite', function (session) {
	console.log("on invite");
	console.log(session.remoteIdentity.uri.user);


    currentSession = session;

    currentSession.on('rejected', function(data) {
        console.log("session rejected");
    });
       
    currentSession.on('failed', function(data) {
        console.log("session failed");
    });
       
    currentSession.on('terminated', function(data) {
        console.log("session terminated");
    });
 
    currentSession.on('cancel', function(data) {
        console.log("session canceled");
    });     
       
    currentSession.on('bye', function(data) {
        console.log("session bye");
    });   
        
    currentSession.on('accepted', function(data) {
        console.log("session accepted");
        console.log(currentSession.remoteIdentity.uri.user);
        /*currentSession.mediaHandler.render({
                //remote: _this.video
            });*/
    });

    /*currentSession.mediaHandler.on('addStream', function () {
        console.log("getting stream");
        currentSession.mediaHandler.render({
            //remote: _this.video
        });
    });*/
	
	currentSession.on('trackAdded', function() {
		console.log("track added");
	
		var remoteVideo = document.getElementById('remote_video');
		var localVideo = document.getElementById('local_video');
		  // We need to check the peer connection to determine which track was added

		  var pc = currentSession.sessionDescriptionHandler.peerConnection;

		  // Gets remote tracks
		  var remoteStream = new MediaStream();
		  console.log(pc.getReceivers());
		  pc.getReceivers().forEach(function(receiver) {
			remoteStream.addTrack(receiver.track);
			console.log(receiver);
		  });
		  remoteVideo.srcObject = remoteStream;
		  remoteVideo.play();

		  // Gets local tracks
		  var localStream = new MediaStream();
		  pc.getSenders().forEach(function(sender) {
			localStream.addTrack(sender.track);
		  });
		  localVideo.srcObject = localStream;
		  localVideo.play();
	});

    currentSession.accept(options);
});
holdButton = document.getElementById('hold');
holdButton.addEventListener("click", function () {
	currentSession.hold();
	console.log("hold");
});

unholdButton = document.getElementById('unhold');
unholdButton.addEventListener("click", function () {
	currentSession.unhold();
	console.log("unhold");
});

ua.on('disconnected', function() {

});

</script>
    

  </body>
</html>
